# Analyze Phase

# ユーザの入力
#$ARGUMENTS

## 目的
UCHosカーネルおよびユーザーランドに関する技術的調査を行い、実装の方向性を決定する。

## 注意事項
- 関連するコードは全て読むこと（特にkernel/, userland/, libs/ディレクトリ）
- 全ての処理においてultrathinkでしっかりと考えて作業を行うこと
- マイクロカーネル設計の原則に従い、カーネル空間に実装すべきか慎重に検討すること
- 既存のテストフレームワーク（kernel/tests/）の活用を検討すること

## タスクに含まれるべきTODO
1. 調査対象・スコープを明確化
   - カーネル機能（メモリ管理、タスク管理、IPC、ファイルシステム、デバイスドライバ）
   - ユーザーランド機能（シェル、コマンド、ライブラリ）
   - システムコールインターフェース
2. 関連ファイル・ログ・ドキュメントを収集し、体系的に分析
   - kernel/docs/内の設計ドキュメント確認
   - 既存実装のコードリーディング
   - テストケースの確認
3. 技術的制約・可能性を調査
   - x86_64アーキテクチャ固有の制約
   - UEFIブート環境の制約
   - マイクロカーネル設計の制約
4. 既存システムとの整合性を確認
   - 命名規則（snake_case、CamelCase）の遵守
   - コーディング規約（K&R、タブインデント）の遵守
   - 既存のAPIとの互換性
5. 問題の根本原因・解決方針を特定
   - カーネル空間での実装が必要か
   - ユーザーランドでの実装が適切か
   - システムコールの追加が必要か
6. 調査結果を文書化し、`docs/analysis/{TIMESTAMP}.md`に保存
   - 調査内容の要約
   - 技術的詳細
   - 実装方針の提案
   - テスト戦略
7. 次フェーズ（Plan）への推奨事項を提示
   - 実装の優先順位
   - リスクと対策
   - 必要なリソース

## UCHos固有の調査ポイント
1. **マイクロカーネル設計の確認**
   - 機能をカーネルに実装すべきか、ユーザーランドに実装すべきか
   - IPCメカニズムの活用可能性
   
2. **既存サブシステムとの統合**
   - メモリ管理（Buddy System、Slab Allocator）
   - タスク管理（ラウンドロビンスケジューラ）
   - ファイルシステム（FAT64）
   - デバイスドライバ（VirtIO、XHCI）

3. **テスト可能性**
   - kernel/tests/フレームワークでのテスト実装
   - ユーザーランドでのテスト戦略

4. **パフォーマンスへの影響**
   - コンテキストスイッチへの影響
   - メモリ使用量
   - システムコール呼び出しのオーバーヘッド

## 出力ファイル
- `docs/analysis/analyze_{TIMESTAMP}.md`

## ドキュメントテンプレート
```markdown
# Analysis Report: [調査対象]

## 概要
[調査の目的と背景を簡潔に記述]

## 調査範囲
- 対象サブシステム: [例: メモリ管理、タスク管理]
- 関連ファイル: [調査したファイルのリスト]
- 影響範囲: [変更が影響する可能性のある領域]

## 技術的詳細
### 現状分析
[既存実装の詳細分析]

### 問題点・改善点
[特定された問題や改善可能な点]

### 制約事項
- アーキテクチャ制約
- 設計制約
- パフォーマンス制約

## 実装方針
### オプション1: [方針名]
- メリット:
- デメリット:
- 実装難易度:

### オプション2: [方針名]
- メリット:
- デメリット:
- 実装難易度:

### 推奨方針
[推奨する実装方針とその理由]

## テスト戦略
- ユニットテスト計画

## リスクと対策
| リスク | 影響度 | 対策 |
|--------|--------|------|
| [リスク1] | 高/中/低 | [対策] |

## 次のステップ
[PLANフェーズでの推奨事項]
```

## 最終出力形式
- 必ず以下の二つの形式で出力を行ってください

### 調査完了（実装推奨）の場合
status: COMPLETED
next: PLAN
details: "docs/analysis/analyze_{TIMESTAMP}.mdを作成。UCHosのマイクロカーネル設計に基づく実装方針を策定"

### 調査完了（実装不要）の場合
status: COMPLETED
next: NONE
details: "調査完了。docs/analysis/analyze_{TIMESTAMP}.mdに詳細を記述。既存機能で対応可能、または設計方針に反するため実装は不要"